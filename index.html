<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate Diagram Generator - Bootstrap Version</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <!-- Custom CSS -->
    <link href="styles.css" rel="stylesheet">
</head>

<body>
    <!-- Floating Donate Button -->
    <div class="donate-floating d-none d-md-block">
        <script src="https://liberapay.com/scansot064/widgets/button.js"></script>
        <noscript>
            <a href="https://liberapay.com/scansot064/donate">
                <img alt="Donate using Liberapay" src="https://liberapay.com/assets/widgets/donate.svg">
            </a>
        </noscript>
    </div>

    <div class="container py-5">
        <div class="card shadow-lg border-0 overflow-hidden">
            <!-- Header -->
            <div class="card-header bg-gradient-primary text-white text-center py-5 border-0">
                <h1 class="display-5 fw-bold mb-2">üå°Ô∏è Climate Diagram Generator</h1>
                <p class="lead mb-0 opacity-75">Select a city from 150,000+ locations worldwide</p>
            </div>

            <div class="row g-0">
                <!-- Input Panel (Sidebar) -->
                <div class="col-lg-4 bg-light p-4 border-end">

                    <div class="accordion" id="inputAccordion">
                        <!-- Section 1: Select Location -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    <strong class="text-primary">üìç Select Location</strong>
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
                                data-bs-parent="#inputAccordion">
                                <div class="accordion-body">
                                    <div class="mb-3">
                                        <label for="continentSelect" class="form-label fw-bold">Continent</label>
                                        <select id="continentSelect" class="form-select" onchange="loadContinent()">
                                            <option value="">-- Select Continent --</option>
                                            <option value="test">üß™ TEST (Fake Data)</option>
                                            <option value="africa">Africa</option>
                                            <option value="asia">Asia</option>
                                            <option value="europe">Europe</option>
                                            <option value="north-america">North America</option>
                                            <option value="south-america">South America</option>
                                            <option value="oceania">Oceania</option>
                                            <option value="arctic">Arctic</option>
                                            <option value="antarctic">Antarctic</option>
                                        </select>
                                        <div id="continentLoading" class="text-muted small mt-1 fst-italic"
                                            style="display:none;">Loading...</div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="countrySelect" class="form-label fw-bold">Country</label>
                                        <select id="countrySelect" class="form-select" onchange="loadCountry()"
                                            disabled>
                                            <option value="">-- Select Country --</option>
                                        </select>
                                    </div>

                                    <div class="mb-3 position-relative">
                                        <label for="citySearch" class="form-label fw-bold">City</label>
                                        <div class="city-autocomplete-container">
                                            <input type="text" id="citySearch" class="form-control"
                                                placeholder="Type to search cities..." disabled autocomplete="off">
                                            <div id="cityDropdown" class="city-dropdown"></div>
                                        </div>
                                        <input type="hidden" id="citySelect" value="">
                                    </div>

                                    <div id="locationInfo"
                                        class="alert alert-primary border-start border-4 border-primary"
                                        style="display:none;">
                                        <p class="mb-1"><strong>Location:</strong> <span id="infoCity"></span></p>
                                        <p class="mb-1"><strong>Country:</strong> <span id="infoCountry"></span></p>
                                        <p class="mb-0"><strong>Coordinates:</strong> <span id="infoCoords"></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Section 2: Manual Input -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    <strong class="text-primary">‚úèÔ∏è Input Your Own Data</strong>
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
                                data-bs-parent="#inputAccordion">
                                <div class="accordion-body">
                                    <div class="mb-3">
                                        <label for="manualCity" class="form-label fw-bold">City/Place Name</label>
                                        <input type="text" id="manualCity" class="form-control"
                                            placeholder="e.g., My Town">
                                    </div>

                                    <div class="mb-3">
                                        <label for="manualCountry" class="form-label fw-bold">Country/Region</label>
                                        <input type="text" id="manualCountry" class="form-control"
                                            placeholder="e.g., My Country">
                                    </div>

                                    <div class="mb-3">
                                        <label for="manualTemp" class="form-label fw-bold">Temperatures (¬∞C)</label>
                                        <input type="text" id="manualTemp" class="form-control"
                                            placeholder="12 values: 10, 12...">
                                        <div class="form-text">Example: 10, 12, 15, 18, 22, 25, 28, 27, 24, 19, 14, 11
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="manualPrecip" class="form-label fw-bold">Precipitation (mm)</label>
                                        <input type="text" id="manualPrecip" class="form-control"
                                            placeholder="12 values: 65, 55...">
                                        <div class="form-text">Example: 65, 55, 50, 55, 70, 80, 60, 65, 75, 85, 80, 70
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Hemisphere (for K√∂ppen)</label>
                                        <div class="d-flex gap-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="manualHemisphere"
                                                    value="north" id="hemiNorth" checked>
                                                <label class="form-check-label" for="hemiNorth">üåç Northern</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="manualHemisphere"
                                                    value="south" id="hemiSouth">
                                                <label class="form-check-label" for="hemiSouth">üåè Southern</label>
                                            </div>
                                        </div>
                                    </div>

                                    <button onclick="generateManualDiagram()"
                                        class="btn btn-info text-white fw-bold w-100">
                                        Generate Custom Diagram
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h5 class="text-primary border-bottom border-primary border-3 pb-2 mb-3">üåç K√∂ppen
                            Classification</h5>
                        <p class="text-muted small">Automatically classify the climate based on diagram data</p>

                        <button onclick="classifyClimate()" id="classifyBtn"
                            class="btn btn-danger w-100 fw-bold text-white mb-3"
                            style="display: none; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border:none;">
                            Classify Climate (K√∂ppen)
                        </button>

                        <div id="koppenResult" class="text-white p-3 rounded"
                            style="display: none; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <h4 class="mb-3">Classification Result</h4>
                            <div id="koppenCode" class="display-4 fw-bold my-2"></div>
                            <div id="koppenDesc" class="p-3 rounded bg-white bg-opacity-25 lh-base"></div>
                        </div>
                    </div>
                </div>

                <!-- Chart Panel (Main Content) -->
                <div class="col-lg-8 p-4 d-flex flex-column align-items-center">
                    <div class="chart-controls w-100 d-flex align-items-center gap-3 mb-4" style="max-width: 800px;">
                        <label for="heightSlider" class="fw-bold text-secondary text-nowrap">Chart Height:</label>
                        <input type="range" class="form-range" id="heightSlider" min="400" max="1000" value="600"
                            step="50" oninput="updateChartHeight(this.value)">
                        <span class="text-primary fw-bold" id="heightValue"
                            style="min-width: 60px; text-align: right;">600px</span>
                    </div>

                    <div id="chartContainer" class="w-100 position-relative" style="max-width: 800px; height: 600px;">
                        <div class="welcome-message text-center text-secondary mt-5 pt-5">
                            <p class="fs-4">üëà Select a city to view<br><strong>its climate diagram</strong></p>
                        </div>
                        <canvas id="climateChart" style="display: none;"></canvas>
                    </div>

                    <button class="btn btn-success fw-bold mt-4 w-100" onclick="exportChart()" id="exportBtn"
                        style="max-width: 800px; display: none;">
                        üíæ Export as PNG
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="fixed-bottom bg-white border-top py-3 text-secondary shadow-lg">
        <div class="container text-center">
            <div class="d-flex justify-content-center gap-3 flex-wrap">
                <a href="https://github.com/scansot064/climate/" target="_blank" rel="noopener"
                    class="text-decoration-none text-primary fw-bold">GitHub Project</a>
                <span class="text-muted">|</span>
                <span>Contact: scansot064 AT g.educaand.es</span>
                <span class="text-muted">|</span>
                <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener"
                    class="text-decoration-none text-primary fw-bold">License CC BY 4.0</a>
            </div>
        </div>
    </footer>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- App Scripts (Ensure this loads after DOM elements are ready) -->
    <script src="scripts.js"></script>
</body>

</html>